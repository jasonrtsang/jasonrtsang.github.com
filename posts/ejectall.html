<!doctype html>
<html lang="en-US">

<head>
    <title>Eject All &ndash; Jason Tsang</title>
    <link rel="stylesheet" href="/style.css">
    <!-- Icons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="About">
    <meta name="author" content="Jason Tsang">

    <!-- Favicon Support: Classic Browsers, Retina Apple Touch Icons, Android Chrome, Windows 8.1/ IE11 Tiles -->
    <link rel="shortcut icon" href="/images/favicon/favicon.ico">
    <link rel="icon" type="image/png" href="/images/favicon/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/images/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/images/favicon/favicon-192x192.png" sizes="192x192">    
    <meta name="apple-mobile-web-app-title" content="JASON TSANG">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/favicon/favicon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/favicon/favicon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon/favicon-180x180.png">
    <link rel="mask-icon" href="/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="/images/favicon/manifest.json">
    <meta name="application-name" content="JASON TSANG">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/images/favicon/browserconfig.xml">
    
    <!-- JQuery Scripts -->
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="/scripts.js"></script>
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-64349546-1', 'auto');
        ga('send', 'pageview');</script> 
</head>

<body>
    <a href="/index.html"><div id="banner"></div></a>
    <div id="nav">
        <a href="/index.html" class="nav_hover">ARCHIVE</a> 
        <a href="/about.html" class="nav_hover">ABOUT</a></div>
    <div class="whitespace"></div>
    <div class="whitespace"></div>
    <div class="whitespace"></div>

    <div class="post">
        <a href="/posts/ejectall.html">
            <h1>Eject All: A physical button to quickly eject all external disks on your Mac</h1></a>
        <div class="date">January 1, 2016</div>
        <div class="whitespace"></div>

        <img alt="Eject All" src="/images/posts/ejectall/ejectall.gif">
        <div class="caption">This convenient tool in action! Green LED lights on success, red when not</div>

        <p>Typically, my MacBook lives its life on my desk with a Time Machine (external hard drive) plugged in. Though, when the time comes for it to travel, I always find it a nuisance to manually eject the Time Machine. This is made worse when the login screen is prompted after being inactive or asleep. With this simple Arduino contraption, I can quickly eject the Time Machine, and any other disks plugged-in, with the press of a button; even on the lock screen.</p>
    
        <p>Parts/ Materials:<ul>
            <li>Arduino Uno</li>
            <li>Breadboard with jump leads</li>
            <li>Push button</li>
            <li>LED (2 colours)</li>
            <li>Resistors</li></ul></p>
    
        <p><a href="https://github.com/jasonrtsang/ejectall"><i class="fa fa-github"></i> Link to source code/ files</a></p>
    
        <p>Below is the basic diagram of how the source files interact on OS X. Each box represents a loop, with their executables within.</p>
    
        <div class="box" style=background-color:#b8dedf><p>launchd (.plist)</p>
            <div class="box" style=background-color:#d8e1e1><p>Python script (.py)</p>
                <div class="box" style=background-color:#e9ecd1><p>AppleScript (.app)</p></div> 
                    <div class="whitespace"></div>   
                <div class="box" style=background-color:#e9ecd1><p>textfile (.txt)</p></div>
            </div></div>
        <div class="whitespace"></div>   
    
        <p>launchd is a management framework that is open-source and built into OS X. It can schedule and manage user-created processes. In this case, the Python script is our process. The script simply polls at the Arduino serial port to see if a character is written to it. If true, the script will trigger the AppleScript, which in turn ejects all external disks. The AppleScript also displays a notification with sound and writes its success to a textfile. The textfile acts as a medium to relay the AppleScript’s output to the Python script. Using the textfile, the Python script writes the value within to the Arduino which in turn lights the corresponding green or red LED.</p>

        <div class="whitespace"></div>
        <img alt="Mac Notification" src="/images/posts/ejectall/notifications.png" class="post_small">
        <div class="caption_small">Two types of notifications are displayed on the Mac. "No external disks were ejected" is shown when there is an error (no disk connected or disk in use)</div>

        <p>There are probably more efficient ways to do this, but judging by its resource usage, it seems to cause no impact to my Macbook’s performance by having a Python script continually poll. Though in terms of deployability, it’s a bit lacking. Every source file has hardcoded dependencies (refer to the <u><a href="https://github.com/jasonrtsang/jasonrtsang.github.com">GitHub page</a></u> for the variables). For instance, this tool (as is) will only work if the Arduino is plugged into the same port. In my case, I have it connected to an USB hub along with the Time Machine and several other accessories. Thus, this problem does not affect me. Note that as launchd is used, there is no configurations necessary after the initial setup. Hence, you can disconnect and reconnect the Arduino (to the same port) and the tool will work automatically.</p>

        <p>On the occasions I don't have the Arduino plugged-in, I can just run the AppleScript to eject the disks. I still find this quicker than manually ejecting. If you wish to only run the AppleScript without the Arduino setup, simply remove the textfile writes by editing the application in Automator.</p>
    
        <p>The Arduino circuit schematic is a mashup of the <u><a href="https://www.arduino.cc/en/Tutorial/Blink">Blink</a></u> and <u><a href="https://www.arduino.cc/en/Tutorial/Button">Button</a></u> tutorials by Arduino. Likewise, for the Arduino firmware, with the addition of the <u><a href="https://www.arduino.cc/en/Tutorial/SoftwareSerialExample">Serial</a></u> tutorial. When the button is pressed, it writes a character to the serial port. The green or red LED lights depending on the input from the serial port.</p>

        <div class="whitespace"></div>
        <img alt="Arduino Setup" src="/images/posts/ejectall/device.jpg">
        <div class="caption">The Arduino Setup</div>

    </div>

    <div class="whitespace"></div>   
    <div class="whitespace"></div>
    <div class="whitespace"></div>    
    <div id="copyright">&copy; 2016-17 Jason Tsang</div>
    <div class="whitespace"></div>
</body>

</html>